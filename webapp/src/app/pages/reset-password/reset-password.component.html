<section class="reset-password">
  <div class="reset-password-content">
    @if (isValidating()) {
      <div class="loading-state">
        <div class="spinner-large"></div>
        <p>Validating your reset link...</p>
      </div>
    } @else if (!isTokenValid()) {
      <div class="error-state">
        <div class="error-icon">
          <svg fill="none" height="48" viewBox="0 0 48 48" width="48" xmlns="http://www.w3.org/2000/svg">
            <circle cx="24" cy="24" fill="currentColor" opacity="0.1" r="24"/>
            <path d="M16 16l16 16M32 16l-16 16" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                  stroke-width="3"/>
          </svg>
        </div>
        <h1>Invalid or Expired Link</h1>
        <p class="reset-password-text">
          This password reset link is no longer valid. It may have expired or already been used.
        </p>
        <a class="btn btn-primary" routerLink="/forgot-password">Request New Link</a>
      </div>
    } @else if (isResetComplete()) {
      <div class="success-state">
        <div class="success-icon">
          <svg fill="none" height="48" viewBox="0 0 48 48" width="48" xmlns="http://www.w3.org/2000/svg">
            <circle cx="24" cy="24" fill="currentColor" opacity="0.1" r="24"/>
            <path d="M15 24l6 6 12-12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                  stroke-width="3"/>
          </svg>
        </div>
        <h1>Password Reset Complete</h1>
        <p class="reset-password-text">
          Your password has been successfully reset. You can now log in with your new password.
        </p>
        <button (click)="goToLogin()" class="btn btn-primary" type="button">
          Log In
        </button>
      </div>
    } @else {
      <h1>Reset your password</h1>
      <p class="reset-password-text">
        Enter your new password below.
      </p>

      <form (ngSubmit)="onSubmit()" class="reset-password-form">
        <div class="form-group">
          <label for="password">New Password</label>
          <input
            (ngModelChange)="password.set($event)"
            [disabled]="isLoading()"
            [ngModel]="password()"
            id="password"
            name="password"
            placeholder="At least 8 characters"
            type="password"
          />
          @if (password()) {
            <app-password-strength-meter [password]="password()"/>
          }
        </div>

        <div class="form-group">
          <label for="confirmPassword">Confirm Password</label>
          <input
            (ngModelChange)="confirmPassword.set($event)"
            [disabled]="isLoading()"
            [ngModel]="confirmPassword()"
            id="confirmPassword"
            name="confirmPassword"
            placeholder="Repeat your password"
            type="password"
          />
        </div>

        @if (error()) {
          <div class="error-message">{{ error() }}</div>
        }

        <button
          [disabled]="isLoading()"
          class="btn btn-primary btn-submit"
          type="submit"
        >
          @if (isLoading()) {
            <span class="spinner"></span>
            <span>Resetting...</span>
          } @else {
            <span>Reset Password</span>
          }
        </button>
      </form>
    }
  </div>
</section>

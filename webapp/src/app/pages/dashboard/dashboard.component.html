<section class="dashboard">
  @if (greeting()) {
    <h1 class="greeting">{{ greeting() }}</h1>
  }

  @if (companyName()) {
    <div class="dashboard-tabs">
      <button
        class="dashboard-tab"
        [class.dashboard-tab--active]="activeTab() === 'applications'"
        (click)="setActiveTab('applications')"
        type="button">
        Applications
      </button>
      @if (roleService.canAccessUsersTab()) {
        <button
          class="dashboard-tab"
          [class.dashboard-tab--active]="activeTab() === 'users'"
          (click)="setActiveTab('users')"
          type="button">
          Users
        </button>
      }
      @if (roleService.canAccessBillingTab()) {
        <button
          (click)="setActiveTab('billing')"
          [class.dashboard-tab--active]="activeTab() === 'billing'"
          class="dashboard-tab"
          type="button">
          Billing
        </button>
      }
    </div>
  }

  <div class="dashboard-content">
    @if (companyName()) {
      @if (activeTab() === 'applications') {
        <h2 class="section-title">Applications of {{ companyName() }}:</h2>
        <div class="app-cards">
          @if (roleService.canCreateApplications()) {
            <app-card [isAddCard]="true" (cardClick)="onAddApplicationClick()"/>
          }
          @for (app of applications(); track app.id) {
            <app-card [name]="app.name" [application]="app" (applicationClick)="onApplicationClick($event)"/>
          }
        </div>

        <!-- Pricing Statistics Section (Admin only) -->
        <ng-container *hasRole="CustomerRole.Admin">
          @if (applications().length > 0) {
            <app-pricing-statistics/>
          }
        </ng-container>
      } @else if (activeTab() === 'users') {
        <h2 class="section-title">Users of {{ companyName() }}:</h2>
        <app-users-table
          [readOnly]="!roleService.canManageUsers()"
          (addUserClick)="onAddUserClick()"
          (editUserClick)="onEditUserClick($event)"/>
      } @else if (activeTab() === 'billing') {
        <h2 class="section-title">Billing & Subscription</h2>
        <app-billing-tab/>
      }
    }
  </div>
</section>

@if (showCompanyOnboarding()) {
  <app-onboarding-overlay>
    @if (showSuccessMessage()) {
      <div class="success-message">
        <div class="success-icon">
          <svg fill="none" height="48" viewBox="0 0 48 48" width="48" xmlns="http://www.w3.org/2000/svg">
            <circle cx="24" cy="24" fill="currentColor" opacity="0.1" r="24"/>
            <path d="M15 24l6 6 12-12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                  stroke-width="3"/>
          </svg>
        </div>
        <h2>Company Created!</h2>
        <p>Setting up your workspace...</p>
      </div>
    } @else {
      <app-company-creation-form (companyCreated)="onCompanyCreated($event)"/>
    }
  </app-onboarding-overlay>
}

@if (showApplicationCreation()) {
  <app-onboarding-overlay [closable]="true" (closeOverlay)="onCloseApplicationCreation()">
    <app-application-creation-form (applicationCreated)="onApplicationCreated($event)"/>
  </app-onboarding-overlay>
}

@if (showUserCreation()) {
  <app-form-overlay (closeOverlay)="onCloseUserCreation()">
    <app-user-creation-form (userCreated)="onUserCreated()"/>
  </app-form-overlay>
}

@if (userToEdit()) {
  <app-form-overlay (closeOverlay)="onCloseUserEdit()">
    <app-user-edit-form [user]="userToEdit()!" (userUpdated)="onUserUpdated($event)"/>
  </app-form-overlay>
}

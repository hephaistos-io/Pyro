<section class="register">
  <div class="register-content">
      @if (isValidatingInvite()) {
          <!-- Loading state while validating invite -->
          <div class="loading-state">
              <div class="spinner"></div>
              <p>Validating your invitation...</p>
          </div>
      } @else if (inviteError()) {
          <!-- Invalid invite error -->
          <div class="invite-error">
              <div class="error-icon">!</div>
              <h2>Invitation Invalid</h2>
              <p>{{ inviteError() }}</p>
              <a routerLink="/login" class="btn btn-primary">Go to Login</a>
          </div>
      } @else if (isInviteFlow()) {
          <!-- Invite-based registration -->
          <div class="invite-banner">
              <span class="invite-badge">Invitation</span>
              <p>You've been invited to join <strong>{{ inviteData()!.companyName }}</strong></p>
          </div>

          <h1>Complete your registration</h1>
          <p class="register-text">
              Set up your account to join {{ inviteData()!.companyName }}
          </p>

          @if (!submitted()) {
              <form class="register-form" (ngSubmit)="onSubmit()">
                  <!-- Email (read-only, from invite) -->
                  <div class="form-group">
                      <label for="email">Email</label>
                      <input
                              id="email"
                              type="email"
                              [value]="email()"
                              name="email"
                              disabled
                              class="email-readonly"
                      />
                  </div>

                  <!-- Name fields in a row -->
                  <div class="name-row">
                      <div class="form-group">
                          <label for="firstName">First Name</label>
                          <input
                                  id="firstName"
                                  type="text"
                                  (ngModelChange)="firstName.set($event)"
                                  [ngModel]="firstName()"
                                  name="firstName"
                                  placeholder="John"
                                  [disabled]="isLoading()"
                          />
                      </div>
                      <div class="form-group">
                          <label for="lastName">Last Name</label>
                          <input
                                  id="lastName"
                                  type="text"
                                  (ngModelChange)="lastName.set($event)"
                                  [ngModel]="lastName()"
                                  name="lastName"
                                  placeholder="Doe"
                                  [disabled]="isLoading()"
                          />
                      </div>
                  </div>

                  <!-- Password fields -->
                  <div class="form-group">
                      <label for="password">Password</label>
                      <input
                              id="password"
                              type="password"
                              (ngModelChange)="password.set($event)"
                              [ngModel]="password()"
                              name="password"
                              placeholder="••••••••"
                              [disabled]="isLoading()"
                      />
                    @if (password()) {
                          <div class="password-strength">
                              <div class="strength-bar">
                                  <div
                                          class="strength-fill"
                                          [attr.data-score]="passwordStrength.score"
                                  ></div>
                              </div>
                              <div class="strength-info">
                  <span class="strength-label" [attr.data-score]="passwordStrength.score">
                    {{ passwordStrength.label }}
                  </span>
                                  @if (passwordStrength.feedback) {
                                      <span class="strength-feedback">{{ passwordStrength.feedback }}</span>
                                  }
                              </div>
                          </div>
                      }
                  </div>

                  <div class="form-group">
                      <label for="confirmPassword">Confirm Password</label>
                      <input
                              id="confirmPassword"
                              type="password"
                              (ngModelChange)="confirmPassword.set($event)"
                              [ngModel]="confirmPassword()"
                              name="confirmPassword"
                              placeholder="••••••••"
                              [disabled]="isLoading()"
                      />
                  </div>

                  @if (error()) {
                      <div class="error-message">{{ error() }}</div>
                  }

                  <button
                          type="submit"
                          class="btn btn-primary btn-submit"
                          [disabled]="isLoading()"
                  >
                      @if (isLoading()) {
                          <span class="spinner"></span>
                          <span>Creating account...</span>
                      } @else {
                          <span>Join {{ inviteData()!.companyName }}</span>
                      }
                  </button>
              </form>

              <p class="auth-link">
                  Already have an account? <a routerLink="/login">Log in</a>
              </p>
          } @else {
              <div class="success-message">
                  <div class="success-icon">✓</div>
                  <h3>Account created!</h3>
                <p>Welcome to {{ inviteData()!.companyName }}, <strong>{{ firstName() }}</strong>!</p>
                  <p class="next-steps">You can now log in to access your team's dashboard.</p>
              </div>
          }
      } @else {
          <!-- Standard registration -->
          <h1>Create your account</h1>
          <p class="register-text">
              Start managing feature flags at super granular level
          </p>

          @if (!submitted()) {
              <form class="register-form" (ngSubmit)="onSubmit()">
                  <!-- Name fields in a row -->
                  <div class="name-row">
                      <div class="form-group">
                          <label for="firstName">First Name</label>
                          <input
                                  id="firstName"
                                  type="text"
                                  (ngModelChange)="firstName.set($event)"
                                  [ngModel]="firstName()"
                                  name="firstName"
                                  placeholder="John"
                                  [disabled]="isLoading()"
                          />
                      </div>
                      <div class="form-group">
                          <label for="lastName">Last Name</label>
                          <input
                                  id="lastName"
                                  type="text"
                                  (ngModelChange)="lastName.set($event)"
                                  [ngModel]="lastName()"
                                  name="lastName"
                                  placeholder="Doe"
                                  [disabled]="isLoading()"
                          />
                      </div>
                  </div>

                  <!-- Email field -->
                  <div class="form-group">
                      <label for="email">Email</label>
                      <input
                              id="email"
                              type="email"
                              (ngModelChange)="email.set($event)"
                              [ngModel]="email()"
                              name="email"
                              placeholder="john@company.com"
                              [disabled]="isLoading()"
                      />
                  </div>

                  <!-- Password fields -->
                  <div class="form-group">
                      <label for="password">Password</label>
                      <input
                              id="password"
                              type="password"
                              (ngModelChange)="password.set($event)"
                              [ngModel]="password()"
                              name="password"
                              placeholder="••••••••"
                              [disabled]="isLoading()"
                      />
                    @if (password()) {
                          <div class="password-strength">
                              <div class="strength-bar">
                                  <div
                                          class="strength-fill"
                                          [attr.data-score]="passwordStrength.score"
                                  ></div>
                              </div>
                              <div class="strength-info">
                  <span class="strength-label" [attr.data-score]="passwordStrength.score">
                    {{ passwordStrength.label }}
                  </span>
                                  @if (passwordStrength.feedback) {
                                      <span class="strength-feedback">{{ passwordStrength.feedback }}</span>
                                  }
                              </div>
                          </div>
                      }
                  </div>

                  <div class="form-group">
                      <label for="confirmPassword">Confirm Password</label>
                      <input
                              id="confirmPassword"
                              type="password"
                              (ngModelChange)="confirmPassword.set($event)"
                              [ngModel]="confirmPassword()"
                              name="confirmPassword"
                              placeholder="••••••••"
                              [disabled]="isLoading()"
                      />
                  </div>

                  @if (error()) {
                      <div class="error-message">{{ error() }}</div>
                  }

                  <button
                          type="submit"
                          class="btn btn-primary btn-submit"
                          [disabled]="isLoading()"
                  >
                      @if (isLoading()) {
                          <span class="spinner"></span>
                          <span>Creating account...</span>
                      } @else {
                          <span>Create Account</span>
                      }
                  </button>
              </form>

              <p class="auth-link">
                  Already have an account? <a routerLink="/login">Log in</a>
              </p>
          } @else {
              <div class="success-message">
                  <div class="success-icon">✓</div>
                <h3>Check your email</h3>
                <p>Welcome to Flagforge, <strong>{{ firstName() }}</strong>!</p>
                <p class="next-steps">We've sent a verification link to <strong>{{ email() }}</strong>.</p>
                <p class="next-steps">Please click the link in the email to verify your account before logging in.</p>
                <a class="btn btn-primary btn-login" routerLink="/login">Go to Login</a>
              </div>
          }
    }
  </div>
</section>
